<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MQTT client library: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="cypress_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MQTT client library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >MQTT client library provides an easy-to-use APIs for Infineon devices to connect with cloud MQTT brokers and perform MQTT publish and subscribe operations.</p>
<h1><a class="anchor" id="section1"></a>
Library components</h1>
<p >This MQTT library consists of two components:<br  />
 1) MQTT wrapper layer<br  />
 2) AWS IoT device SDK C library</p>
<p >AWS IoT device SDK library is an open-source library, which uses the <a href="https://devops-git.aus.cypress.com/repo/aws-iot-device-sdk-port">aws-iot-device-sdk-port</a> library functions to perform MQTT network-related operations. Applications that uses this library should invoke the MQTT wrapper-layer API functions and those which internally calls AWS IoT device SDK library and aws-iot-device-sdk-port library API functions to perform MQTT publish/subscribe operations.</p>
<p ><a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/202103.00">AWS-IoT Device SDK C Library Link</a></p>
<h2><a class="anchor" id="section1_1"></a>
MQTT wrapper layer</h2>
<p >This wrapper layer provides the APIs that are required to perform MQTT publish and subscribe operations on Infineon platforms. This layer contains APIs that are used for creating MQTT instances, establishing "secure" or non-secure MQTT client session with an MQTT broker to send and receive MQTT messages. This layer also handles retry logic for failed publish messages.</p>
<h2><a class="anchor" id="section1_2"></a>
AWS IoT Device SDK C - Tag: 202103.00</h2>
<p >This is an open-source MQTT library developed and maintained by Amazon. This library implements the core MQTT protocol logic.</p>
<ul>
<li>"AWS IoT Device SDK C" library provides the following features:<ul>
<li>MQTT 3.1.1 client</li>
<li>Synchronous API for MQTT operations</li>
<li>Multi-threaded API by default</li>
<li>Complete separation of MQTT and the network stack, allowing MQTT to run on top of any network stack</li>
<li>Supports MQTT persistent sessions</li>
<li>Supports quality-of-service (QoS) levels 0, 1, and 2</li>
<li>Supports MQTT connection over both secured and non-secured TCP connections</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="section_platforms"></a>
Supported platforms</h1>
<p >This library and its features are supported on the following Infineon platforms:</p><ul>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8cproto-062-4343w/">PSoC&trade; 6 Wi-Fi Bluetooth&reg; prototyping kit (CY8CPROTO-062-4343W)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ckit-062s2-43012/">PSoC&trade; 62S2 Wi-Fi Bluetooth&reg; pioneer kit (CY8CKIT-062S2-43012)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ckit-062-wifi-bt/">PSoC&trade; 6 Wi-Fi Bluetooth&reg; pioneer kit (CY8CKIT-062-WiFi-BT)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ckit-064s0s2-4343w/">PSoC&trade; 64S0S2 Wi-Fi Bluetooth&reg; pioneer kit (CY8CKIT-064S0S2-4343W)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ceval-062s2/">PSoC&trade; 62S2 evaluation kit (CY8CEVAL-062S2-LAI-4373M2)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cyw954907aeval1f/">CYW943907AEVAL1F Evaluation Kit(CYW943907AEVAL1F)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cyw943907aeval1f/">CYW954907AEVAL1F Evaluation Kit(CYW954907AEVAL1F)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ceval-062s2/">PSoC&trade; 62S2 evaluation kit (CY8CEVAL-062S2-MUR-43439M2)</a></li>
</ul>
<h1><a class="anchor" id="section_dependencies"></a>
Dependent libraries</h1>
<p >This MQTT client library depends on the following library. This library is included by default.</p><ul>
<li><a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/202103.00">AWS-IoT device SDK library</a></li>
</ul>
<h1><a class="anchor" id="section_quick_start"></a>
Quick start</h1>
<ul>
<li>Ensure that the application includes *./include/cy_mqtt_api.h* to use the library APIs and structure.</li>
<li>The reference *./include/core_mqtt_config.h* file that is bundled with this library provides the default configurations required for the <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/202103.00">AWS IoT device SDK</a> library.</li>
<li>By default <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/202103.00">AWS IoT device SDK</a> library logging is turned off. To enable log messages, logging related macro's <code>LogError</code>, <code>LogWarn</code>, <code>LogInfo</code>, and <code>LogDebug</code> in *./include/core_mqtt_config.h* should be mapped to the application-specific logging implementation.</li>
<li>A "reasonable amount of time" to wait for keepalive response from the MQTT broker. The timeout value can be configured using the macro <code>MQTT_PINGRESP_TIMEOUT_MS</code> in the application Makefile. This value may be adjusted to suit the use case and network conditions. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += MQTT_PINGRESP_TIMEOUT_MS=5000</div>
</div><!-- fragment --></li>
<li>A "maximum polling duration" that is allowed without any data reception from the network for the incoming packet. The timeout value can be configured using the macro <code>MQTT_RECV_POLLING_TIMEOUT_MS</code> in the application Makefile. This value may be adjusted to suit the use case and network conditions. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += MQTT_RECV_POLLING_TIMEOUT_MS=1000</div>
</div><!-- fragment --><ol type="1">
<li>It is important to note that having this timeout too short will result in MQTT being disconnected due to the possibility of partial data being received. If you have small TCP buffers and a high latency network, the optimum value for the timeout can be surprisingly long. In such cases, optimum value for the timeout can be better determined based on experimenting the MQTT applications with payloads bigger than the TCP buffer. See <a href="https://docs.aws.amazon.com/embedded-csdk/202103.00/lib-ref/libraries/standard/coreMQTT/docs/doxygen/output/html/mqtt_timeouts.html#mqtt_timeouts_receive_polling">AWS coreMQTT documentation</a> for more details.</li>
</ol>
</li>
<li>A "maximum duration" that is allowed for no data transmission over the network through the transport send function. The timeout value can be configured using the macro <code>MQTT_SEND_RETRY_TIMEOUT_MS</code> in the application Makefile. This value may be adjusted to suit the use case and network conditions. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += MQTT_SEND_RETRY_TIMEOUT_MS=500</div>
</div><!-- fragment --><ol type="1">
<li>See <a href="https://docs.aws.amazon.com/embedded-csdk/202103.00/lib-ref/libraries/standard/coreMQTT/docs/doxygen/output/html/mqtt_timeouts.html#mqtt_timeouts_send_retry">AWS coreMQTT documentation</a> for more details.</li>
</ol>
</li>
<li>A "reasonable amount of time" to wait for receiving the acknowledgment packet from the MQTT broker for MQTT publish/Subscribe messages with QoS1/QoS2. The timeout value can be configured using the macro <code>CY_MQTT_ACK_RECEIVE_TIMEOUT_MS</code> in the application Makefile. This value may be adjusted to suit the use case and network conditions. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += <a class="code hl_define" href="group__mqtt__defines.html#ga7840d8ac595e18a481833643bafdb21b">CY_MQTT_ACK_RECEIVE_TIMEOUT_MS</a>=3000</div>
<div class="ttc" id="agroup__mqtt__defines_html_ga7840d8ac595e18a481833643bafdb21b"><div class="ttname"><a href="group__mqtt__defines.html#ga7840d8ac595e18a481833643bafdb21b">CY_MQTT_ACK_RECEIVE_TIMEOUT_MS</a></div><div class="ttdeci">#define CY_MQTT_ACK_RECEIVE_TIMEOUT_MS</div><div class="ttdoc">Maximum wait time in milliseconds to receive acknowledgment packet from the MQTT broker for QoS1/QoS2...</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:160</div></div>
</div><!-- fragment --></li>
<li>The MQTT message send timeout can be configured using the macro <code>CY_MQTT_MESSAGE_SEND_TIMEOUT_MS</code> in the application Makefile. This value can be adjusted to suit the use case and network conditions. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += <a class="code hl_define" href="group__mqtt__defines.html#gac85b5246aa00763d8633fc335dfe17d1">CY_MQTT_MESSAGE_SEND_TIMEOUT_MS</a>=3000</div>
<div class="ttc" id="agroup__mqtt__defines_html_gac85b5246aa00763d8633fc335dfe17d1"><div class="ttname"><a href="group__mqtt__defines.html#gac85b5246aa00763d8633fc335dfe17d1">CY_MQTT_MESSAGE_SEND_TIMEOUT_MS</a></div><div class="ttdeci">#define CY_MQTT_MESSAGE_SEND_TIMEOUT_MS</div><div class="ttdoc">MQTT message send timeout in milliseconds.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:171</div></div>
</div><!-- fragment --></li>
<li>The MQTT message receive timeout can be configured using the macro <code>CY_MQTT_MESSAGE_RECEIVE_TIMEOUT_MS</code> in the application Makefile. This value can be adjusted to suit the use case and network conditions. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += <a class="code hl_define" href="group__mqtt__defines.html#ga266a36c789a8d384ab0036bda69e8d56">CY_MQTT_MESSAGE_RECEIVE_TIMEOUT_MS</a>=500</div>
<div class="ttc" id="agroup__mqtt__defines_html_ga266a36c789a8d384ab0036bda69e8d56"><div class="ttname"><a href="group__mqtt__defines.html#ga266a36c789a8d384ab0036bda69e8d56">CY_MQTT_MESSAGE_RECEIVE_TIMEOUT_MS</a></div><div class="ttdeci">#define CY_MQTT_MESSAGE_RECEIVE_TIMEOUT_MS</div><div class="ttdoc">MQTT message receive timeout for the subscribed topic, represented in milliseconds.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:182</div></div>
</div><!-- fragment --></li>
<li>The MQTT library provides a retry mechanism for MQTT publish/subscribe/unsubscribe messages when the acknowledgement is not received from the broker on time. You can configure the maximum number of retries by defining the macro <code>CY_MQTT_MAX_RETRY_VALUE</code> in the application Makefile. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += <a class="code hl_define" href="group__mqtt__defines.html#gaa2cdd709ec4d91cb8f8522b606ce82c9">CY_MQTT_MAX_RETRY_VALUE</a>=3</div>
<div class="ttc" id="agroup__mqtt__defines_html_gaa2cdd709ec4d91cb8f8522b606ce82c9"><div class="ttname"><a href="group__mqtt__defines.html#gaa2cdd709ec4d91cb8f8522b606ce82c9">CY_MQTT_MAX_RETRY_VALUE</a></div><div class="ttdeci">#define CY_MQTT_MAX_RETRY_VALUE</div><div class="ttdoc">Maximum number of retry for MQTT publish/subscribe/unsubcribe message send.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:193</div></div>
</div><!-- fragment --></li>
<li>If user need to perform multiple publish operations simultaneously on a single MQTT instance, then <code>CY_MQTT_MAX_OUTGOING_PUBLISHES</code> macro needs be configured with the number of simultaneous publish operation that user wants to perform. For the default value of this macro, refer to MQTT library API header file. This macro can be configured by adding a define in the application Makefile. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += <a class="code hl_define" href="group__mqtt__defines.html#gab7e064d14b782a9509cddcb4c909784c">CY_MQTT_MAX_OUTGOING_PUBLISHES</a>=2</div>
<div class="ttc" id="agroup__mqtt__defines_html_gab7e064d14b782a9509cddcb4c909784c"><div class="ttname"><a href="group__mqtt__defines.html#gab7e064d14b782a9509cddcb4c909784c">CY_MQTT_MAX_OUTGOING_PUBLISHES</a></div><div class="ttdeci">#define CY_MQTT_MAX_OUTGOING_PUBLISHES</div><div class="ttdoc">Configure value of maximum number of outgoing publishes maintained in MQTT library until an ack is re...</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:206</div></div>
</div><!-- fragment --></li>
<li>If user need to perform multiple subscribe operations simultaneously on a single MQTT instance, then <code>CY_MQTT_MAX_OUTGOING_SUBSCRIBES</code> macro needs be configured with the number of simultaneous subscribe operation that user wants to perform. For the default value of this macro, refer to MQTT library API header file. This macro can be configured by adding a define in the application Makefile. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += <a class="code hl_define" href="group__mqtt__defines.html#gacce957bd0962c40b85a0a53124f9a7f4">CY_MQTT_MAX_OUTGOING_SUBSCRIBES</a>=2</div>
<div class="ttc" id="agroup__mqtt__defines_html_gacce957bd0962c40b85a0a53124f9a7f4"><div class="ttname"><a href="group__mqtt__defines.html#gacce957bd0962c40b85a0a53124f9a7f4">CY_MQTT_MAX_OUTGOING_SUBSCRIBES</a></div><div class="ttdeci">#define CY_MQTT_MAX_OUTGOING_SUBSCRIBES</div><div class="ttdoc">Configure value of maximum number of outgoing subscription topics maintained in MQTT library until an...</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:213</div></div>
</div><!-- fragment --></li>
<li>This MQTT Client library does not support secure connections to the public <code>test.mosquitto.org</code> broker by default. This is because the server uses the SHA1 hashing algorithm. As cautioned by Mbed TLS, SHA-1 is considered a weak message digest and is therefore not enabled in Mbed TLS by default. The use of SHA-1 for certificate signing constitutes a security risk. It is recommended to avoid dependencies on it, and consider stronger message digests instead.</li>
<li>Review and make the required changes to the pre-defined configuration files.<ul>
<li>The configuration files are bundled with the wifi-mw-core library for FreeRTOS, lwIP, and Mbed TLS. See <a href="https://github.com/Infineon/wifi-mw-core/blob/master/README.md">README.md</a> for more details.</li>
<li>If the application is using bundle library then the configuration files are in the bundle library. For example if the application is using <em>Wi-Fi core freertos lwip mbedtls bundle library</em>, the configuration files are in <code>wifi-core-freertos-lwip-mbedtls/configs</code> folder. Similarly if the application is using <em>Ethernet Core FreeRTOS lwIP mbedtls library</em>, the configuration files are in <code>ethernet-core-freertos-lwip-mbedtls/configs</code> folder.</li>
</ul>
</li>
<li>Define the following COMPONENTS in the application's Makefile for the MQTT Library. <div class="fragment"><div class="line">COMPONENTS=FREERTOS MBEDTLS LWIP SECURE_SOCKETS</div>
</div><!-- fragment --></li>
<li>The "aws-iot-device-sdk-port" layer includes the "coreHTTP" and "coreMQTT" modules of the "aws-iot-device-sdk-embedded-C" library by default. If the user application doesn't use HTTP client features, update the application Makefile to exclude the coreHTTP source files from the build. The Makefile entry should look like the following: <div class="fragment"><div class="line">CY_IGNORE+= $(SEARCH_aws-iot-device-sdk-embedded-C)/libraries/standard/coreHTTP</div>
<div class="line">CY_IGNORE+= libs/aws-iot-device-sdk-embedded-C/libraries/standard/coreHTTP</div>
</div><!-- fragment --></li>
<li>The MQTT library is supported on multiple platforms. When it is used on secured platforms such as CY8CKIT-064S0S2-4343W, the macros <code>CY_TFM_PSA_SUPPORTED</code> and <code>TFM_MULTI_CORE_NS_OS</code> need to be defined in the application Makefile. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += CY_TFM_PSA_SUPPORTED TFM_MULTI_CORE_NS_OS</div>
</div><!-- fragment --></li>
<li>To enable PKCS-PSA support on secured platforms such as CY8CKIT-064S0S2-4343W, the macro <code>CY_SECURE_SOCKETS_PKCS_SUPPORT</code> needs to be defined in the application Makefile. The Makefile entry should look like the following: <div class="fragment"><div class="line">DEFINES += CY_SECURE_SOCKETS_PKCS_SUPPORT</div>
</div><!-- fragment --></li>
<li>Secured platform like CY8CKIT-064S0S2-4343W use trusted-firmware-m library for crypto operations. Due to security vulnerability in HW acceleration, trusted-firmware-m version v1.3.3 uses software implementation for ECC crypto algorithm. Since the software implementation is slower, it is recommended to set configEXPECTED_IDLE_TIME_BEFORE_SLEEP to atleast 100.<ul>
<li>configEXPECTED_IDLE_TIME_BEFORE_SLEEP value can be changed in the application's FreeRTOSConfig.h</li>
</ul>
</li>
<li>To compile the MQTT library successfully for secure platforms such as CY8CKIT-064S0S2-4343W, the trusted firmware library include path needs to be added before the MBEDTLS library include path in the application Makefile. The Makefile entry should look like the following: <div class="fragment"><div class="line">INCLUDES=$(SEARCH_trusted-firmware-m)/COMPONENT_TFM_NS_INTERFACE/include</div>
<div class="line">INCLUDES+=libs/trusted-firmware-m/COMPONENT_TFM_NS_INTERFACE/include</div>
</div><!-- fragment --></li>
<li>The MQTT Library disables all the debug log messages by default. To enable log messages, the application must perform the following:<ol type="1">
<li>Add the <code>ENABLE_MQTT_LOGS</code> macro to the <em>DEFINES</em> in the code example's Makefile. The Makefile entry should look like as follows: <div class="fragment"><div class="line">DEFINES+=ENABLE_MQTT_LOGS</div>
</div><!-- fragment --></li>
<li>Call the <code>cy_log_init()</code> function provided by the <em>cy-log</em> module. cy-log is part of the <em>connectivity-utilities</em> library. See <a href="https://infineon.github.io/connectivity-utilities/api_reference_manual/html/group__logging__utils.html">connectivity-utilities library API documentation</a> for cy-log details.</li>
</ol>
</li>
</ul>
<h1><a class="anchor" id="section_Library_Usage_Notes"></a>
Library usage notes</h1>
<ul>
<li>See <a href="https://github.com/Infineon/mqtt/blob/master/README.md">MQTT client library README.md</a> for usage notes.</li>
</ul>
<h1><a class="anchor" id="Additional_info"></a>
Additional information</h1>
<ul>
<li><a href="https://github.com/Infineon/mqtt/blob/master/RELEASE.md">MQTT client library RELEASE.md</a> .</li>
<li><a href="https://www.infineon.com/cms/en/design-support/tools/sdk/modustoolbox-software">ModusToolbox&trade; software environment, quick start guide, documentation, and videos</a> .</li>
<li><a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/202103.00">AWS-IoT device SDK Library</a> .</li>
<li><a href="https://github.com/infineon?q=mtb-example-anycloud%20NOT%20Deprecated">ModusToolbox&trade; code examples</a> .</li>
</ul>
<h1><a class="anchor" id="mqtt_api_call_sequence"></a>
API call sequence</h1>
<p >This section provides the details of the API call sequence for performing various MQTT operations. This call sequence uses APIs defined by the MQTT library.</p>
<h2><a class="anchor" id="section2_1"></a>
For Init, Create, Connect, Publish, and Subscribe</h2>
<p >The API call sequence given below should be used to connect to a MQTT broker and to perform MQTT subscribe and publish operations:</p>
<pre class="fragment">                    +-----------------------+
                    |     cy_mqtt_init()    |
                    +-----------------------+
                                |
                                v
                    +-----------------------+
                    |    cy_mqtt_create()   |
                    +-----------------------+
                                |
                                v
                    +-----------------------+
                    |   cy_mqtt_connect()   |
                    +-----------------------+
                                |
                                v
                    +-----------------------+
                    |  cy_mqtt_subscribe()  |
                    +-----------------------+
                                |
                                v
                    +-----------------------+
                    |   cy_mqtt_publish()   |
                    +-----------------------+
</pre><h2><a class="anchor" id="section2_2"></a>
For UnSubscribe, Disconnect, Delete, and DeInit.</h2>
<p >The API call sequence given below should be used to perform MQTT unsubscribe and disconnect operations with the MQTT broker: </p><pre class="fragment">                   +-----------------------+
                   | cy_mqtt_unsubscribe() |
                   +-----------------------+
                               |
                               v
                   +-----------------------+
                   |  cy_mqtt_disconnect() |
                   +-----------------------+
                               |
                               v
                   +-----------------------+
                   |    cy_mqtt_delete()   |
                   +-----------------------+
                               |
                               v
                   +-----------------------+
                   |    cy_mqtt_deinit()   |
                   +-----------------------+
</pre><h2><a class="anchor" id="section2_3"></a>
Note:</h2>
<ul>
<li>Functions <a class="el" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a> and <a class="el" href="group__mqtt__api__functions.html#ga7193aa962b03640955740db074fb36fb">cy_mqtt_deinit</a> are not thread-safe.</li>
<li>The application should allocate a network buffer and the same buffer must be passed while creating the MQTT object. The MQTT library useS this buffer for sending and receiving MQTT packets. <a class="el" href="group__mqtt__defines.html#ga18d0c836b0120b44ea0066d20a741d81">CY_MQTT_MIN_NETWORK_BUFFER_SIZE</a> is the minimum size of the network buffer required for the library to handle MQTT packets.</li>
<li>The application should call <a class="el" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a> before calling any other MQTT library function, and should not call other MQTT library functions after calling <a class="el" href="group__mqtt__api__functions.html#ga7193aa962b03640955740db074fb36fb">cy_mqtt_deinit</a>.</li>
<li>The MQTT instance is created using the <a class="el" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a> function. The MQTT library allocates resources for each created instance; therefore, the application should delete the MQTT instance by calling <a class="el" href="group__mqtt__api__functions.html#gacdd40da0ad0e6bfb55fbf14c2aca0577">cy_mqtt_delete</a> after performing the desired MQTT operations.</li>
<li>After calling the <a class="el" href="group__mqtt__api__functions.html#gacdd40da0ad0e6bfb55fbf14c2aca0577">cy_mqtt_delete</a> API function, all resources associated with the MQTT handle are freed. Therefore, the application must not use the same MQTT handle after delete.</li>
<li>The MQTT disconnection event notification is not sent to the application when the disconnection is initiated from the application.</li>
<li>When the application receives the MQTT disconnection event notification due to below reasons, the application must call the <a class="el" href="group__mqtt__api__functions.html#gab7be772e82d3f8a80e1cbb1da156be17">cy_mqtt_disconnect</a> function to release the resources allocated during <a class="el" href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b">cy_mqtt_connect</a>.<ol type="1">
<li>When network is disconnected.</li>
<li>When ping response is not received from broker for the ping request sent, possibly broker is down.</li>
<li>When a bad response received form the MQTT broker. Possibly received a MQTT packet with invalid packet type ID.</li>
<li>When MQTT packet send/receive is failed due to high network latency and smaller values set for MQTT_RECV_POLLING_TIMEOUT_MS and/or MQTT_SEND_RETRY_TIMEOUT_MS macros.</li>
</ol>
</li>
</ul>
<h2><a class="anchor" id="section2_4"></a>
For secured platform CY8CKIT-064S0S2-4343W:</h2>
<ul>
<li>See <a href="https://github.com/Infineon/mqtt/blob/master/README.md">MQTT Client Library README.md</a> for usage instructions.</li>
</ul>
<h1><a class="anchor" id="section_code_snippet"></a>
Code snippets</h1>
<h2><a class="anchor" id="snip1"></a>
Code Snippet 1: Initialize an MQTT network socket</h2>
<p >This code snippet demonstrates the initialization of the network sockets required for the MQTT library. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_init( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__mqtt__api__functions_html_ga5386e4d0061fd77c3f68ba29553b3414"><div class="ttname"><a href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_init(void)</div><div class="ttdoc">Performs network sockets initialization required for the MQTT library.</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="snip2"></a>
Code Snippet 2: Creating an MQTT instance for secured connection with the MQTT broker</h2>
<p >This code snippet demonstrates the initialization of the configuration structures required for creating an MQTT client handle for establishing a secured connection with an MQTT broker, and the usage of the <a class="el" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9" title="Creates a MQTT instance and initializes its members based on the supplied arguments.">cy_mqtt_create()</a> API function. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_SECURED                   ( 8883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> client_cert[] = { <span class="stringliteral">&quot;Paste client certificate here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> client_key[]  = { <span class="stringliteral">&quot;Paste client key here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> root_ca_cert[] = { <span class="stringliteral">&quot;Paste RootCA certificate here&quot;</span> };</div>
<div class="line"> </div>
<div class="line">cy_mqtt_t         secure_mqtthandle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keywordtype">void</span> mqtt_secure_event_cb( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_create_secure( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    cy_awsport_ssl_credentials_t  credentials;</div>
<div class="line">    cy_awsport_ssl_credentials_t  *security = NULL;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line">    memset( &amp;credentials, 0x00, <span class="keyword">sizeof</span>( cy_awsport_ssl_credentials_t ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the credential information. */</span></div>
<div class="line">    credentials.client_cert = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;client_cert;</div>
<div class="line">    credentials.client_cert_size = <span class="keyword">sizeof</span>( client_cert );</div>
<div class="line">    credentials.private_key = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;client_key;</div>
<div class="line">    credentials.private_key_size = <span class="keyword">sizeof</span>( client_key );</div>
<div class="line">    credentials.root_ca = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;root_ca_cert;</div>
<div class="line">    credentials.root_ca_size = <span class="keyword">sizeof</span>( root_ca_cert );</div>
<div class="line"> </div>
<div class="line">    security = &amp;credentials;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              security, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_secure_event_cb, NULL,</div>
<div class="line">                              &amp;secure_mqtthandle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__mqtt__api__functions_html_ga127e0c74fd6f6025f4866d581256df96"><div class="ttname"><a href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a></div><div class="ttdeci">void(* cy_mqtt_callback_t)(cy_mqtt_t mqtt_handle, cy_mqtt_event_t event, void *user_data)</div><div class="ttdoc">MQTT event callback functions type used to process the disconnect event and incoming MQTT publish pac...</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:402</div></div>
<div class="ttc" id="agroup__mqtt__api__functions_html_ga6637e2df9ebc12dfb98841fc38c88ce9"><div class="ttname"><a href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_create(uint8_t *buffer, uint32_t buff_len, cy_awsport_ssl_credentials_t *security, cy_mqtt_broker_info_t *broker_info, cy_mqtt_callback_t event_callback, void *user_data, cy_mqtt_t *mqtt_handle)</div><div class="ttdoc">Creates a MQTT instance and initializes its members based on the supplied arguments.</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb"><div class="ttname"><a href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a></div><div class="ttdeci">@ CY_MQTT_EVENT_TYPE_DISCONNECT</div><div class="ttdoc">Disconnected from MQTT broker.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:247</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de"><div class="ttname"><a href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a></div><div class="ttdeci">@ CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</div><div class="ttdoc">Message from the subscribed topic.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:246</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805"><div class="ttname"><a href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a></div><div class="ttdeci">@ CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</div><div class="ttdoc">Network is disconnected.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:256</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130"><div class="ttname"><a href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a></div><div class="ttdeci">@ CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</div><div class="ttdoc">MQTT packet send or receive operation failed due to network latency (or) send/receive related timeout...</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:258</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884"><div class="ttname"><a href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a></div><div class="ttdeci">@ CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</div><div class="ttdoc">Bad response from MQTT broker.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:257</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb"><div class="ttname"><a href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a></div><div class="ttdeci">@ CY_MQTT_DISCONN_TYPE_BROKER_DOWN</div><div class="ttdoc">Keep-alive not received from broker, possibly broker is down</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:255</div></div>
<div class="ttc" id="astructcy__mqtt__broker__info__t_html"><div class="ttname"><a href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a></div><div class="ttdoc">MQTT broker information structure.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:315</div></div>
<div class="ttc" id="astructcy__mqtt__broker__info__t_html_a1573327c42b9dd49610c55aa303e7fea"><div class="ttname"><a href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">cy_mqtt_broker_info_t::hostname</a></div><div class="ttdeci">const char * hostname</div><div class="ttdoc">Server host name.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:316</div></div>
<div class="ttc" id="astructcy__mqtt__broker__info__t_html_a38a8850406cc4f8e267e67837a23cd41"><div class="ttname"><a href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">cy_mqtt_broker_info_t::hostname_len</a></div><div class="ttdeci">uint16_t hostname_len</div><div class="ttdoc">Length of the server host name.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:317</div></div>
<div class="ttc" id="astructcy__mqtt__broker__info__t_html_ad90a2e276913e9598673e31d55ce808e"><div class="ttname"><a href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">cy_mqtt_broker_info_t::port</a></div><div class="ttdeci">uint16_t port</div><div class="ttdoc">Server port in host-order.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:318</div></div>
<div class="ttc" id="astructcy__mqtt__event__t_html"><div class="ttname"><a href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a></div><div class="ttdoc">MQTT event information structure.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:356</div></div>
<div class="ttc" id="astructcy__mqtt__event__t_html_a3f9c7a86ef0794a434c7c1f34605a15f"><div class="ttname"><a href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">cy_mqtt_event_t::data</a></div><div class="ttdeci">union cy_mqtt_event_t::@0 data</div><div class="ttdoc">Event data.</div></div>
<div class="ttc" id="astructcy__mqtt__event__t_html_a73dadd9c182b0786d9ed11fb7bb91c65"><div class="ttname"><a href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">cy_mqtt_event_t::pub_msg</a></div><div class="ttdeci">cy_mqtt_message_t pub_msg</div><div class="ttdoc">Received MQTT message for event type CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:361</div></div>
<div class="ttc" id="astructcy__mqtt__event__t_html_a9823ea0788cb4e0bd82efd19d195b13e"><div class="ttname"><a href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">cy_mqtt_event_t::type</a></div><div class="ttdeci">cy_mqtt_event_type_t type</div><div class="ttdoc">Event type.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:357</div></div>
<div class="ttc" id="astructcy__mqtt__event__t_html_abbc35b761acab1cda2d4f85418f9c32e"><div class="ttname"><a href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">cy_mqtt_event_t::reason</a></div><div class="ttdeci">cy_mqtt_disconn_type_t reason</div><div class="ttdoc">Disconnection reason for event type CY_MQTT_EVENT_TYPE_DISCONNECT.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:360</div></div>
<div class="ttc" id="astructcy__mqtt__message__t_html_ae158e70e0ed56cfa2fe80a2e6407b1bc"><div class="ttname"><a href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">cy_mqtt_message_t::packet_id</a></div><div class="ttdeci">uint16_t packet_id</div><div class="ttdoc">Packet ID of the MQTT message.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:348</div></div>
<div class="ttc" id="astructcy__mqtt__publish__info__t_html"><div class="ttname"><a href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a></div><div class="ttdoc">MQTT publish information structure.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:301</div></div>
<div class="ttc" id="astructcy__mqtt__publish__info__t_html_a3642a0462fa346cfcc8d114ba78a425e"><div class="ttname"><a href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">cy_mqtt_publish_info_t::payload_len</a></div><div class="ttdeci">size_t payload_len</div><div class="ttdoc">Message payload length.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:308</div></div>
<div class="ttc" id="astructcy__mqtt__publish__info__t_html_a766647fe8a245f81ff5b2ed5ab57e556"><div class="ttname"><a href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">cy_mqtt_publish_info_t::payload</a></div><div class="ttdeci">const char * payload</div><div class="ttdoc">Message payload.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:307</div></div>
<div class="ttc" id="astructcy__mqtt__publish__info__t_html_aacdf24feaf4d2ceb5c055e50d26ce432"><div class="ttname"><a href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">cy_mqtt_publish_info_t::topic</a></div><div class="ttdeci">const char * topic</div><div class="ttdoc">Topic name on which the message is published.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:305</div></div>
<div class="ttc" id="astructcy__mqtt__publish__info__t_html_ad6c63ce8dd222f55eb6bb3825bee57af"><div class="ttname"><a href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">cy_mqtt_publish_info_t::topic_len</a></div><div class="ttdeci">uint16_t topic_len</div><div class="ttdoc">Length of topic name.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:306</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="snip3"></a>
Code Snippet 3: Creating an MQTT instance for a non-secured connection with an MQTT broker</h2>
<p >This code snippet demonstrates the initialization of the configuration structures required for creating an MQTT client handle for establishing a non-secured connection with an MQTT broker, and the usage of the <a class="el" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9" title="Creates a MQTT instance and initializes its members based on the supplied arguments.">cy_mqtt_create()</a> API function. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_NON_SECURED               ( 1883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line">cy_mqtt_t         nonsecure_mqtthandle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keywordtype">void</span> mqtt_non_secure_event_cb( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_create_non_secure( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_NON_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              NULL, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_non_secure_event_cb, NULL,</div>
<div class="line">                              &amp;nonsecure_mqtthandle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
</div><!-- fragment --> <h2><a class="anchor" id="snip4"></a>
Code Snippet 4: Establishing an MQTT client session</h2>
<p >This code snippet demonstrates the steps to establish an MQTT client session with an MQTT broker using the previously created MQTT handle, and the usage of the <a class="el" href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b" title="Connects to the given MQTT broker using a secured/non-secured TCP connection and establishes MQTT cli...">cy_mqtt_connect()</a> API function. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_SECURED                   ( 8883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER              &quot;CypressTest&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER_LENGTH       ( ( uint16_t ) ( sizeof( MQTT_CLIENT_IDENTIFIER ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_KEEP_ALIVE_INTERVAL_SECONDS    ( 60U )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_QOS2                           ( 2U )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC                          &quot;Test_Topic&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC_LENGTH                   ( ( uint16_t ) ( sizeof( MQTT_TOPIC ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE                   &quot;Will message - World!&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE_LENGTH            ( ( uint16_t ) ( sizeof( MQTT_WILL_MESSAGE ) - 1 ) )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> clientcert[] = { <span class="stringliteral">&quot;Paste client certificate here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> clientkey[]  = { <span class="stringliteral">&quot;Paste client key here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> rootcacertificate[] = { <span class="stringliteral">&quot;Paste RootCA certificate here&quot;</span> };</div>
<div class="line"> </div>
<div class="line">cy_mqtt_t         mqtthandle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> mqtt_event_cb( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_connect( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a>        will_msg;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a>        connect_info;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    cy_awsport_ssl_credentials_t  credentials;</div>
<div class="line">    cy_awsport_ssl_credentials_t  *security = NULL;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;will_msg, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a> ) );</div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line">    memset( &amp;connect_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a> ) );</div>
<div class="line">    memset( &amp;credentials, 0x00, <span class="keyword">sizeof</span>( cy_awsport_ssl_credentials_t ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the will information. */</span></div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ac3dd00abb3e55019b0f41f169f047d65">qos</a> = (<a class="code hl_enumeration" href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a>) MQTT_QOS2;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> = MQTT_TOPIC;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a> = MQTT_TOPIC_LENGTH;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> = MQTT_WILL_MESSAGE;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a> = MQTT_WILL_MESSAGE_LENGTH;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the credential information. */</span></div>
<div class="line">    credentials.client_cert = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;clientcert;</div>
<div class="line">    credentials.client_cert_size = <span class="keyword">sizeof</span>( clientcert );</div>
<div class="line">    credentials.private_key = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;clientkey;</div>
<div class="line">    credentials.private_key_size = <span class="keyword">sizeof</span>( clientkey );</div>
<div class="line">    credentials.root_ca = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;rootcacertificate;</div>
<div class="line">    credentials.root_ca_size = <span class="keyword">sizeof</span>( rootcacertificate );</div>
<div class="line"> </div>
<div class="line">    security = &amp;credentials;</div>
<div class="line"> </div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a3df6c6eb014ef6e7566616ece9fa5b1b">client_id</a> = MQTT_CLIENT_IDENTIFIER;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#ad6ff55a3dfeb52324950c2447d9c8c4e">client_id_len</a> = MQTT_CLIENT_IDENTIFIER_LENGTH;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a40ded02bb2c432ed7080c1589ebef8e5">keep_alive_sec</a> = MQTT_KEEP_ALIVE_INTERVAL_SECONDS;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a0238ef1799952c8eeaf4c61c9187c3a6">will_info</a> = &amp;will_msg;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              security, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_event_cb, NULL,</div>
<div class="line">                              &amp;mqtthandle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b">cy_mqtt_connect</a>( mqtthandle, &amp;connect_info );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__mqtt__api__functions_html_ga2ffecf6ed7940d97c2c6fbc83783417b"><div class="ttname"><a href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b">cy_mqtt_connect</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_connect(cy_mqtt_t mqtt_handle, cy_mqtt_connect_info_t *connect_info)</div><div class="ttdoc">Connects to the given MQTT broker using a secured/non-secured TCP connection and establishes MQTT cli...</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_ga78bd2ae3cdea69f18ffec6a72bbc28be"><div class="ttname"><a href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a></div><div class="ttdeci">cy_mqtt_qos_t</div><div class="ttdoc">MQTT QoS levels.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:234</div></div>
<div class="ttc" id="astructcy__mqtt__connect__info__t_html"><div class="ttname"><a href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a></div><div class="ttdoc">MQTT connect information structure.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:325</div></div>
<div class="ttc" id="astructcy__mqtt__connect__info__t_html_a0238ef1799952c8eeaf4c61c9187c3a6"><div class="ttname"><a href="structcy__mqtt__connect__info__t.html#a0238ef1799952c8eeaf4c61c9187c3a6">cy_mqtt_connect_info_t::will_info</a></div><div class="ttdeci">cy_mqtt_publish_info_t * will_info</div><div class="ttdoc">MQTT will message.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:334</div></div>
<div class="ttc" id="astructcy__mqtt__connect__info__t_html_a3df6c6eb014ef6e7566616ece9fa5b1b"><div class="ttname"><a href="structcy__mqtt__connect__info__t.html#a3df6c6eb014ef6e7566616ece9fa5b1b">cy_mqtt_connect_info_t::client_id</a></div><div class="ttdeci">const char * client_id</div><div class="ttdoc">MQTT client identifier.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:326</div></div>
<div class="ttc" id="astructcy__mqtt__connect__info__t_html_a40ded02bb2c432ed7080c1589ebef8e5"><div class="ttname"><a href="structcy__mqtt__connect__info__t.html#a40ded02bb2c432ed7080c1589ebef8e5">cy_mqtt_connect_info_t::keep_alive_sec</a></div><div class="ttdeci">uint16_t keep_alive_sec</div><div class="ttdoc">MQTT keep alive period.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:333</div></div>
<div class="ttc" id="astructcy__mqtt__connect__info__t_html_ad6ff55a3dfeb52324950c2447d9c8c4e"><div class="ttname"><a href="structcy__mqtt__connect__info__t.html#ad6ff55a3dfeb52324950c2447d9c8c4e">cy_mqtt_connect_info_t::client_id_len</a></div><div class="ttdeci">uint16_t client_id_len</div><div class="ttdoc">Length of the client identifier.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:327</div></div>
<div class="ttc" id="astructcy__mqtt__publish__info__t_html_ac3dd00abb3e55019b0f41f169f047d65"><div class="ttname"><a href="structcy__mqtt__publish__info__t.html#ac3dd00abb3e55019b0f41f169f047d65">cy_mqtt_publish_info_t::qos</a></div><div class="ttdeci">cy_mqtt_qos_t qos</div><div class="ttdoc">Quality of Service for message.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:302</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="snip5"></a>
Code Snippet 5: MQTT subscribe and unsubscribe</h2>
<p >This code snippet demonstrates the steps to subscribe for particular topic, unsubscribe from a previously subscribed MQTT topic, and the usage of the <a class="el" href="group__mqtt__api__functions.html#gac9e1748d2425be6923069fa6f7125fb5" title="Subscribes for MQTT message on the given MQTT topic or list of topics.">cy_mqtt_subscribe()</a> and <a class="el" href="group__mqtt__api__functions.html#ga5bf4f13c41463bd239f2940a02401121" title="Unsubscribes from a given MQTT topic.">cy_mqtt_unsubscribe()</a> API functions. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_SECURED                   ( 8883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER              &quot;CypressTest&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER_LENGTH       ( ( uint16_t ) ( sizeof( MQTT_CLIENT_IDENTIFIER ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_KEEP_ALIVE_INTERVAL_SECONDS    ( 60U )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_QOS2                           ( 2U )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC                          &quot;Test_Topic&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC_LENGTH                   ( ( uint16_t ) ( sizeof( MQTT_TOPIC ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE                   &quot;Will message - World!&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE_LENGTH            ( ( uint16_t ) ( sizeof( MQTT_WILL_MESSAGE ) - 1 ) )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_NUM_OF_SUBS_IN_SINGLE_REQ      ( 1U )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_NUM_OF_UNSUBS_IN_SINGLE_REQ    MQTT_NUM_OF_SUBS_IN_SINGLE_REQ</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> client_certificate[]  = { <span class="stringliteral">&quot;Paste client certificate here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> client_private_key[]  = { <span class="stringliteral">&quot;Paste client key here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> root_ca_certificate[] = { <span class="stringliteral">&quot;Paste RootCA certificate here&quot;</span> };</div>
<div class="line">cy_mqtt_t         mqtt_handle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keywordtype">void</span> mqtt_eventcb( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_subscribe_unsubscribe( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a>        will_msg;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a>        connect_info;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    cy_awsport_ssl_credentials_t  credentials;</div>
<div class="line">    cy_awsport_ssl_credentials_t  *security = NULL;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__subscribe__info__t.html">cy_mqtt_subscribe_info_t</a>      sub_msg[1];</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__subscribe__info__t.html">cy_mqtt_unsubscribe_info_t</a>    unsub_msg[1];</div>
<div class="line"> </div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;will_msg, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a> ) );</div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line">    memset( &amp;connect_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a> ) );</div>
<div class="line">    memset( &amp;credentials, 0x00, <span class="keyword">sizeof</span>( cy_awsport_ssl_credentials_t ) );</div>
<div class="line">    memset( &amp;sub_msg, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__subscribe__info__t.html">cy_mqtt_subscribe_info_t</a> ) );</div>
<div class="line">    memset( &amp;unsub_msg, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__subscribe__info__t.html">cy_mqtt_unsubscribe_info_t</a> ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the will information. */</span></div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ac3dd00abb3e55019b0f41f169f047d65">qos</a> = (<a class="code hl_enumeration" href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a>)MQTT_QOS2;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> = MQTT_TOPIC;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a> = MQTT_TOPIC_LENGTH;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> = MQTT_WILL_MESSAGE;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a> = MQTT_WILL_MESSAGE_LENGTH;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the credential information. */</span></div>
<div class="line">    credentials.client_cert = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;client_certificate;</div>
<div class="line">    credentials.client_cert_size = <span class="keyword">sizeof</span>( client_certificate );</div>
<div class="line">    credentials.private_key = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;client_private_key;</div>
<div class="line">    credentials.private_key_size = <span class="keyword">sizeof</span>( client_private_key );</div>
<div class="line">    credentials.root_ca = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;root_ca_certificate;</div>
<div class="line">    credentials.root_ca_size = <span class="keyword">sizeof</span>( root_ca_certificate );</div>
<div class="line"> </div>
<div class="line">    security = &amp;credentials;</div>
<div class="line"> </div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a3df6c6eb014ef6e7566616ece9fa5b1b">client_id</a> = MQTT_CLIENT_IDENTIFIER;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#ad6ff55a3dfeb52324950c2447d9c8c4e">client_id_len</a> = MQTT_CLIENT_IDENTIFIER_LENGTH;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a40ded02bb2c432ed7080c1589ebef8e5">keep_alive_sec</a> = MQTT_KEEP_ALIVE_INTERVAL_SECONDS;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a0238ef1799952c8eeaf4c61c9187c3a6">will_info</a> = &amp;will_msg;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              security, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_eventcb, NULL,</div>
<div class="line">                              &amp;mqtt_handle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b">cy_mqtt_connect</a>( mqtt_handle, &amp;connect_info );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Subscribe request. */</span></div>
<div class="line">    sub_msg[0].<a class="code hl_variable" href="structcy__mqtt__subscribe__info__t.html#aa4b608145f6dca9d3740d43d83a5f960">qos</a> = (<a class="code hl_enumeration" href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a>)MQTT_QOS2;</div>
<div class="line">    sub_msg[0].<a class="code hl_variable" href="structcy__mqtt__subscribe__info__t.html#a7233b6d440d794a302673089552f7acb">topic</a> = MQTT_TOPIC;</div>
<div class="line">    sub_msg[0].<a class="code hl_variable" href="structcy__mqtt__subscribe__info__t.html#a2bd950023cbd33864c6bc6343af7b06b">topic_len</a> = MQTT_TOPIC_LENGTH;</div>
<div class="line"> </div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#gac9e1748d2425be6923069fa6f7125fb5">cy_mqtt_subscribe</a>( mqtt_handle, &amp;sub_msg[0], MQTT_NUM_OF_SUBS_IN_SINGLE_REQ );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check status of MQTT broker allocated QoS level for subscribed topics in subscribe request. */</span></div>
<div class="line">    <span class="keywordflow">if</span>( sub_msg[0].allocated_qos == <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga78bd2ae3cdea69f18ffec6a72bbc28beaac77e0934620e20e664d3145facf6486">CY_MQTT_QOS_INVALID</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* MQTT broker rejected subscribe request for the given topic/QoS level. */</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* MQTT broker assigned the QoS level &#39;sub_msg[0].allocated_qos&#39; for the subscribed topic. */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Wait for some time for subscribed topic messages.</span></div>
<div class="line"><span class="comment">     * Once after receiving the message on the subscribed topic, callback function</span></div>
<div class="line"><span class="comment">     * mqtt_eventcb() will be called from mqtt library context with</span></div>
<div class="line"><span class="comment">     * receive event type &#39;CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE&#39; and payload.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * ----- Add the code logic here to wait for the subscribed messages. -----</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Unsubscribe request. */</span></div>
<div class="line">    unsub_msg[0].<a class="code hl_variable" href="structcy__mqtt__subscribe__info__t.html#aa4b608145f6dca9d3740d43d83a5f960">qos</a> = (<a class="code hl_enumeration" href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a>)MQTT_QOS2;</div>
<div class="line">    unsub_msg[0].<a class="code hl_variable" href="structcy__mqtt__subscribe__info__t.html#a7233b6d440d794a302673089552f7acb">topic</a> = MQTT_TOPIC;</div>
<div class="line">    unsub_msg[0].<a class="code hl_variable" href="structcy__mqtt__subscribe__info__t.html#a2bd950023cbd33864c6bc6343af7b06b">topic_len</a> = MQTT_TOPIC_LENGTH;</div>
<div class="line"> </div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5bf4f13c41463bd239f2940a02401121">cy_mqtt_unsubscribe</a>( mqtt_handle, &amp;unsub_msg[0], MQTT_NUM_OF_UNSUBS_IN_SINGLE_REQ );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__mqtt__api__functions_html_ga5bf4f13c41463bd239f2940a02401121"><div class="ttname"><a href="group__mqtt__api__functions.html#ga5bf4f13c41463bd239f2940a02401121">cy_mqtt_unsubscribe</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_unsubscribe(cy_mqtt_t mqtt_handle, cy_mqtt_unsubscribe_info_t *unsub_info, uint8_t unsub_count)</div><div class="ttdoc">Unsubscribes from a given MQTT topic.</div></div>
<div class="ttc" id="agroup__mqtt__api__functions_html_gac9e1748d2425be6923069fa6f7125fb5"><div class="ttname"><a href="group__mqtt__api__functions.html#gac9e1748d2425be6923069fa6f7125fb5">cy_mqtt_subscribe</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_subscribe(cy_mqtt_t mqtt_handle, cy_mqtt_subscribe_info_t *sub_info, uint8_t sub_count)</div><div class="ttdoc">Subscribes for MQTT message on the given MQTT topic or list of topics.</div></div>
<div class="ttc" id="agroup__mqtt__struct_html_gga78bd2ae3cdea69f18ffec6a72bbc28beaac77e0934620e20e664d3145facf6486"><div class="ttname"><a href="group__mqtt__struct.html#gga78bd2ae3cdea69f18ffec6a72bbc28beaac77e0934620e20e664d3145facf6486">CY_MQTT_QOS_INVALID</a></div><div class="ttdeci">@ CY_MQTT_QOS_INVALID</div><div class="ttdoc">Invalid QoS.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:238</div></div>
<div class="ttc" id="astructcy__mqtt__subscribe__info__t_html"><div class="ttname"><a href="structcy__mqtt__subscribe__info__t.html">cy_mqtt_subscribe_info_t</a></div><div class="ttdoc">MQTT subscribe information structure.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:289</div></div>
<div class="ttc" id="astructcy__mqtt__subscribe__info__t_html_a2bd950023cbd33864c6bc6343af7b06b"><div class="ttname"><a href="structcy__mqtt__subscribe__info__t.html#a2bd950023cbd33864c6bc6343af7b06b">cy_mqtt_subscribe_info_t::topic_len</a></div><div class="ttdeci">uint16_t topic_len</div><div class="ttdoc">Length of subscription topic filter.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:292</div></div>
<div class="ttc" id="astructcy__mqtt__subscribe__info__t_html_a7233b6d440d794a302673089552f7acb"><div class="ttname"><a href="structcy__mqtt__subscribe__info__t.html#a7233b6d440d794a302673089552f7acb">cy_mqtt_subscribe_info_t::topic</a></div><div class="ttdeci">const char * topic</div><div class="ttdoc">Topic filter to subscribe to.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:291</div></div>
<div class="ttc" id="astructcy__mqtt__subscribe__info__t_html_aa4b608145f6dca9d3740d43d83a5f960"><div class="ttname"><a href="structcy__mqtt__subscribe__info__t.html#aa4b608145f6dca9d3740d43d83a5f960">cy_mqtt_subscribe_info_t::qos</a></div><div class="ttdeci">cy_mqtt_qos_t qos</div><div class="ttdoc">Requested quality of Service for the subscription.</div><div class="ttdef"><b>Definition:</b> cy_mqtt_api.h:290</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="snip6"></a>
Code Snippet 6: MQTT publish</h2>
<p >This code snippet demonstrates the steps to publish messages on an MQTT topic, and the usage of the <a class="el" href="group__mqtt__api__functions.html#ga2b565253902a622a2c275c61ef1fd84f" title="Publishes the MQTT message on given MQTT topic.">cy_mqtt_publish()</a> API function. You can choose an appropriate QoS level for the application. In this snippet, the QoS level is set as 2. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_SECURED                   ( 8883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER              &quot;CypressTest&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER_LENGTH       ( ( uint16_t ) ( sizeof( MQTT_CLIENT_IDENTIFIER ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_KEEP_ALIVE_INTERVAL_SECONDS    ( 60U )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_QOS2                           ( 2U )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC                          &quot;Test_Topic&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC_LENGTH                   ( ( uint16_t ) ( sizeof( MQTT_TOPIC ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE                   &quot;Will message - World!&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE_LENGTH            ( ( uint16_t ) ( sizeof( MQTT_WILL_MESSAGE ) - 1 ) )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_PUB_MESSAGE                    &quot;Publish - Hello MQTT!&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_PUB_MESSAGE_LENGTH             ( ( uint16_t ) ( sizeof( MQTT_PUB_MESSAGE ) - 1 ) )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> clientcertificate[]  = { <span class="stringliteral">&quot;Paste client certificate here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> clientprivate_key[]  = { <span class="stringliteral">&quot;Paste client key here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> rootca_certificate[] = { <span class="stringliteral">&quot;Paste RootCA certificate here&quot;</span> };</div>
<div class="line">cy_mqtt_t         MQTThandle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keywordtype">void</span> mqtt_event_call_back( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_publish( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a>        will_msg;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a>        connect_info;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    cy_awsport_ssl_credentials_t  credentials;</div>
<div class="line">    cy_awsport_ssl_credentials_t  *security = NULL;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a>        pub_msg;</div>
<div class="line"> </div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;will_msg, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a> ) );</div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line">    memset( &amp;connect_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a> ) );</div>
<div class="line">    memset( &amp;credentials, 0x00, <span class="keyword">sizeof</span>( cy_awsport_ssl_credentials_t ) );</div>
<div class="line">    memset( &amp;pub_msg, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a> ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the will information. */</span></div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ac3dd00abb3e55019b0f41f169f047d65">qos</a> = (<a class="code hl_enumeration" href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a>)MQTT_QOS2;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> = MQTT_TOPIC;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a> = MQTT_TOPIC_LENGTH;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> = MQTT_WILL_MESSAGE;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a> = MQTT_WILL_MESSAGE_LENGTH;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the credential information. */</span></div>
<div class="line">    credentials.client_cert = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;clientcertificate;</div>
<div class="line">    credentials.client_cert_size = <span class="keyword">sizeof</span>( clientcertificate );</div>
<div class="line">    credentials.private_key = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;clientprivate_key;</div>
<div class="line">    credentials.private_key_size = <span class="keyword">sizeof</span>( clientprivate_key );</div>
<div class="line">    credentials.root_ca = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;rootca_certificate;</div>
<div class="line">    credentials.root_ca_size = <span class="keyword">sizeof</span>( rootca_certificate );</div>
<div class="line"> </div>
<div class="line">    security = &amp;credentials;</div>
<div class="line"> </div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a3df6c6eb014ef6e7566616ece9fa5b1b">client_id</a> = MQTT_CLIENT_IDENTIFIER;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#ad6ff55a3dfeb52324950c2447d9c8c4e">client_id_len</a> = MQTT_CLIENT_IDENTIFIER_LENGTH;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a40ded02bb2c432ed7080c1589ebef8e5">keep_alive_sec</a> = MQTT_KEEP_ALIVE_INTERVAL_SECONDS;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a0238ef1799952c8eeaf4c61c9187c3a6">will_info</a> = &amp;will_msg;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              security, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_event_call_back, NULL,</div>
<div class="line">                              &amp;MQTThandle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b">cy_mqtt_connect</a>( MQTThandle, &amp;connect_info );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pub_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ac3dd00abb3e55019b0f41f169f047d65">qos</a> = (<a class="code hl_enumeration" href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a>)MQTT_QOS2;</div>
<div class="line">    pub_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> = MQTT_TOPIC;</div>
<div class="line">    pub_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a> = MQTT_TOPIC_LENGTH;</div>
<div class="line">    pub_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> = MQTT_PUB_MESSAGE;</div>
<div class="line">    pub_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a> = MQTT_PUB_MESSAGE_LENGTH;</div>
<div class="line"> </div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga2b565253902a622a2c275c61ef1fd84f">cy_mqtt_publish</a>( MQTThandle, &amp;pub_msg );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__mqtt__api__functions_html_ga2b565253902a622a2c275c61ef1fd84f"><div class="ttname"><a href="group__mqtt__api__functions.html#ga2b565253902a622a2c275c61ef1fd84f">cy_mqtt_publish</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_publish(cy_mqtt_t mqtt_handle, cy_mqtt_publish_info_t *pub_msg)</div><div class="ttdoc">Publishes the MQTT message on given MQTT topic.</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="snip7"></a>
Code Snippet 7: MQTT disconnect</h2>
<p >This code snippet demonstrates the steps to end an already established MQTT client session with an MQTT broker, and the usage of the <a class="el" href="group__mqtt__api__functions.html#gab7be772e82d3f8a80e1cbb1da156be17" title="Initiates MQTT client disconnection from connected MQTT broker.">cy_mqtt_disconnect()</a> API function. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_SECURED                   ( 8883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER              &quot;CypressTest&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER_LENGTH       ( ( uint16_t ) ( sizeof( MQTT_CLIENT_IDENTIFIER ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_KEEP_ALIVE_INTERVAL_SECONDS    ( 60U )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_QOS2                           ( 2U )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC                          &quot;Test_Topic&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC_LENGTH                   ( ( uint16_t ) ( sizeof( MQTT_TOPIC ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE                   &quot;Will message - World!&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE_LENGTH            ( ( uint16_t ) ( sizeof( MQTT_WILL_MESSAGE ) - 1 ) )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> MQTT_clientcertificate[]  = { <span class="stringliteral">&quot;Paste client certificate here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> MQTT_clientprivate_key[]  = { <span class="stringliteral">&quot;Paste client key here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> MQTT_rootca_certificate[] = { <span class="stringliteral">&quot;Paste RootCA certificate here&quot;</span> };</div>
<div class="line"> </div>
<div class="line">cy_mqtt_t         MQTT_handle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keywordtype">void</span> mqtt_events_cb( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_disconnect( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a>        will_msg;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a>        connect_info;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    cy_awsport_ssl_credentials_t  credentials;</div>
<div class="line">    cy_awsport_ssl_credentials_t  *security = NULL;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;will_msg, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_publish_info_t</a> ) );</div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line">    memset( &amp;connect_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a> ) );</div>
<div class="line">    memset( &amp;credentials, 0x00, <span class="keyword">sizeof</span>( cy_awsport_ssl_credentials_t ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the will information. */</span></div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ac3dd00abb3e55019b0f41f169f047d65">qos</a> = (<a class="code hl_enumeration" href="group__mqtt__struct.html#ga78bd2ae3cdea69f18ffec6a72bbc28be">cy_mqtt_qos_t</a>)MQTT_QOS2;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> = MQTT_TOPIC;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a> = MQTT_TOPIC_LENGTH;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> = MQTT_WILL_MESSAGE;</div>
<div class="line">    will_msg.<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a> = MQTT_WILL_MESSAGE_LENGTH;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the credential information. */</span></div>
<div class="line">    credentials.client_cert = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;MQTT_clientcertificate;</div>
<div class="line">    credentials.client_cert_size = <span class="keyword">sizeof</span>( MQTT_clientcertificate );</div>
<div class="line">    credentials.private_key = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;MQTT_clientprivate_key;</div>
<div class="line">    credentials.private_key_size = <span class="keyword">sizeof</span>( MQTT_clientprivate_key );</div>
<div class="line">    credentials.root_ca = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;MQTT_rootca_certificate;</div>
<div class="line">    credentials.root_ca_size = <span class="keyword">sizeof</span>( MQTT_rootca_certificate );</div>
<div class="line"> </div>
<div class="line">    security = &amp;credentials;</div>
<div class="line"> </div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a3df6c6eb014ef6e7566616ece9fa5b1b">client_id</a> = MQTT_CLIENT_IDENTIFIER;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#ad6ff55a3dfeb52324950c2447d9c8c4e">client_id_len</a> = MQTT_CLIENT_IDENTIFIER_LENGTH;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a40ded02bb2c432ed7080c1589ebef8e5">keep_alive_sec</a> = MQTT_KEEP_ALIVE_INTERVAL_SECONDS;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a0238ef1799952c8eeaf4c61c9187c3a6">will_info</a> = &amp;will_msg;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              security, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_events_cb, NULL,</div>
<div class="line">                              &amp;MQTT_handle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b">cy_mqtt_connect</a>( MQTT_handle, &amp;connect_info );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Do MQTT publish and subscribe here. */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Calling MQTT disconnect to end the MQTT client session with the broker. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#gab7be772e82d3f8a80e1cbb1da156be17">cy_mqtt_disconnect</a>( MQTT_handle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__mqtt__api__functions_html_gab7be772e82d3f8a80e1cbb1da156be17"><div class="ttname"><a href="group__mqtt__api__functions.html#gab7be772e82d3f8a80e1cbb1da156be17">cy_mqtt_disconnect</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_disconnect(cy_mqtt_t mqtt_handle)</div><div class="ttdoc">Initiates MQTT client disconnection from connected MQTT broker.</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="snip8"></a>
Code Snippet 8: MQTT delete and deinit</h2>
<p >This code snippet demonstrates the de-allocation of the configuration structures and resources which are allocated during an MQTT client handle creation, and the usage of the <a class="el" href="group__mqtt__api__functions.html#gacdd40da0ad0e6bfb55fbf14c2aca0577" title="Deletes the given MQTT instance and frees the resources allocated for the instance by the cy_mqtt_cre...">cy_mqtt_delete()</a> and <a class="el" href="group__mqtt__api__functions.html#ga7193aa962b03640955740db074fb36fb" title="One-time deinitialization function for network sockets implementation.">cy_mqtt_deinit()</a> API functions. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_SECURED                   ( 8883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER              &quot;CypressTest&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER_LENGTH       ( ( uint16_t ) ( sizeof( MQTT_CLIENT_IDENTIFIER ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_KEEP_ALIVE_INTERVAL_SECONDS    ( 60U )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_QOS2                           ( 2U )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC                          &quot;Test_Topic&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_TOPIC_LENGTH                   ( ( uint16_t ) ( sizeof( MQTT_TOPIC ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE                   &quot;Will message - World!&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_WILL_MESSAGE_LENGTH            ( ( uint16_t ) ( sizeof( MQTT_WILL_MESSAGE ) - 1 ) )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> MQTT_client_certificate[] = { <span class="stringliteral">&quot;Paste client certificate here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> MQTT_client_key[]  = { <span class="stringliteral">&quot;Paste client key here&quot;</span> };</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> MQTT_root_ca_certificate[] = { <span class="stringliteral">&quot;Paste RootCA certificate here&quot;</span> };</div>
<div class="line"> </div>
<div class="line">cy_mqtt_t         MQTT_obj_handle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keywordtype">void</span> mqtt_callback( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_delete( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    <span class="comment">/* Status variables for various operations */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    cy_awsport_ssl_credentials_t  credentials;</div>
<div class="line">    cy_awsport_ssl_credentials_t  *security = NULL;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line">    memset( &amp;credentials, 0x00, <span class="keyword">sizeof</span>( cy_awsport_ssl_credentials_t ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the credential information. */</span></div>
<div class="line">    credentials.client_cert = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;MQTT_client_certificate;</div>
<div class="line">    credentials.client_cert_size = <span class="keyword">sizeof</span>( MQTT_client_certificate );</div>
<div class="line">    credentials.private_key = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;MQTT_client_key;</div>
<div class="line">    credentials.private_key_size = <span class="keyword">sizeof</span>( MQTT_client_key );</div>
<div class="line">    credentials.root_ca = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;MQTT_root_ca_certificate;</div>
<div class="line">    credentials.root_ca_size = <span class="keyword">sizeof</span>( MQTT_root_ca_certificate );</div>
<div class="line"> </div>
<div class="line">    security = &amp;credentials;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              security, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_callback, NULL,</div>
<div class="line">                              &amp;MQTT_obj_handle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Calling MQTT Delete to clean up the resources allocated during create. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#gacdd40da0ad0e6bfb55fbf14c2aca0577">cy_mqtt_delete</a>( mqtthandle );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    mqtthandle = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* De-initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga7193aa962b03640955740db074fb36fb">cy_mqtt_deinit</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__mqtt__api__functions_html_ga7193aa962b03640955740db074fb36fb"><div class="ttname"><a href="group__mqtt__api__functions.html#ga7193aa962b03640955740db074fb36fb">cy_mqtt_deinit</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_deinit(void)</div><div class="ttdoc">One-time deinitialization function for network sockets implementation.</div></div>
<div class="ttc" id="agroup__mqtt__api__functions_html_gacdd40da0ad0e6bfb55fbf14c2aca0577"><div class="ttname"><a href="group__mqtt__api__functions.html#gacdd40da0ad0e6bfb55fbf14c2aca0577">cy_mqtt_delete</a></div><div class="ttdeci">cy_rslt_t cy_mqtt_delete(cy_mqtt_t mqtt_handle)</div><div class="ttdoc">Deletes the given MQTT instance and frees the resources allocated for the instance by the cy_mqtt_cre...</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="snip9"></a>
Code Snippet 9: MQTT client on the secured platform CY8CKIT-064S0S2-4343W</h2>
<p >This code snippet demonstrates the steps to establish an MQTT client session using the certificates and keys stored in the secured memory. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_BROKER                         &quot; &quot;</span> <span class="comment">/* Add the broker end point info here. */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MQTT_PORT_SECURED                   ( 8883 )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER              &quot;CypressTest&quot;</span></div>
<div class="line"><span class="preprocessor">#define MQTT_CLIENT_IDENTIFIER_LENGTH       ( ( uint16_t ) ( sizeof( MQTT_CLIENT_IDENTIFIER ) - 1 ) )</span></div>
<div class="line"><span class="preprocessor">#define MQTT_KEEP_ALIVE_INTERVAL_SECONDS    ( 60U )</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NETWORK_BUFFER_SIZE                 ( 1024U )</span></div>
<div class="line"> </div>
<div class="line">cy_mqtt_t         mqtthandle_pkcs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback function registered with MQTT library while creating handle for MQTT connection.</span></div>
<div class="line"><span class="comment">   This callback function will be called by MQTT library upon receiving MQTT messages on subscribed topics or when</span></div>
<div class="line"><span class="comment">   network disconnection happens. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> mqtt_event_cb_pkcs( cy_mqtt_t mqtt_handle, <a class="code hl_struct" href="structcy__mqtt__event__t.html">cy_mqtt_event_t</a> event, <span class="keywordtype">void</span> *user_data )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__publish__info__t.html">cy_mqtt_received_msg_info_t</a> *received_msg;</div>
<div class="line">    printf( <span class="stringliteral">&quot;\nMQTT App callback with handle : %p \n&quot;</span>, mqtt_handle );</div>
<div class="line">    (void)user_data;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a9823ea0788cb4e0bd82efd19d195b13e">type</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaa0a7b7d2061d3a6331115e521c16fa0fb">CY_MQTT_EVENT_TYPE_DISCONNECT</a> :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT Disconnect event.\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">switch</span>( event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#abbc35b761acab1cda2d4f85418f9c32e">reason</a> )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a99e819db5a5b4c25e2eda4658e4a2ebb">CY_MQTT_DISCONN_TYPE_BROKER_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Keep-alive response not received from broker, possibly broker is down. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT Ping response not received within keep-alive response timeout... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a434e424ed02e3f4fb2ccad520b7f0805">CY_MQTT_DISCONN_TYPE_NETWORK_DOWN</a> :</div>
<div class="line">                    <span class="comment">/* Network is disconnected. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Network is disconnected... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a4db84d670967fcbc08d81621427d5130">CY_MQTT_DISCONN_TYPE_SND_RCV_FAIL</a> :</div>
<div class="line">                    <span class="comment">/* MQTT packet send or receive operation failed due to network latency (or) send/receive related timeouts. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : MQTT packet send or receive operation failed... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga4e499e4898c3baae910860d7ce73f300a67fc4279a46c2520953486ab71cd4884">CY_MQTT_DISCONN_TYPE_BAD_RESPONSE</a> :</div>
<div class="line">                    <span class="comment">/* Bad response from MQTT broker. Possibly received MQTT packet with invalid packet type ID. */</span></div>
<div class="line">                    printf( <span class="stringliteral">&quot;Reason : Bad response from MQTT broker... \n\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                default :</div>
<div class="line">                    printf( <span class="stringliteral">&quot;\n Unknown disconnect reason .....\n&quot;</span> );</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__mqtt__struct.html#gga1cefedb516ade340c9a829ec7b998fbaac017ae74a362a60128e4bc0482a085de">CY_MQTT_EVENT_TYPE_SUBSCRIPTION_MESSAGE_RECEIVE</a> :</div>
<div class="line">            <span class="comment">/* Received MQTT messages on subscribed topic. */</span></div>
<div class="line">            printf( <span class="stringliteral">&quot;\nEvent : Received MQTT subscribed message receive event.\n&quot;</span> );</div>
<div class="line">            received_msg = &amp;(<span class="keyword">event</span>.data.pub_msg.received_message);</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Topic Name: %.*s\n&quot;</span>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#ad6c63ce8dd222f55eb6bb3825bee57af">topic_len</a>, received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#aacdf24feaf4d2ceb5c055e50d26ce432">topic</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish message Packet Id is %u.\n&quot;</span>, event.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a3f9c7a86ef0794a434c7c1f34605a15f">data</a>.<a class="code hl_variable" href="structcy__mqtt__event__t.html#a73dadd9c182b0786d9ed11fb7bb91c65">pub_msg</a>.<a class="code hl_variable" href="structcy__mqtt__message__t.html#ae158e70e0ed56cfa2fe80a2e6407b1bc">packet_id</a> );</div>
<div class="line">            printf( <span class="stringliteral">&quot;Incoming Publish Message : %.*s.\n\n&quot;</span>, ( <span class="keywordtype">int</span> )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a3642a0462fa346cfcc8d114ba78a425e">payload_len</a>, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * )received_msg-&gt;<a class="code hl_variable" href="structcy__mqtt__publish__info__t.html#a766647fe8a245f81ff5b2ed5ab57e556">payload</a> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        default :</div>
<div class="line">            printf( <span class="stringliteral">&quot;\nUNKNOWN EVENT .....\n&quot;</span> );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef CY_TFM_PSA_SUPPORTED</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct  </span>ns_mailbox_queue_t ns_mailbox_queue;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> tfm_ns_multi_core_boot(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    int32_t ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (tfm_ns_wait_for_s_cpu_ready())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error sync&#39;ing with secure core */</span></div>
<div class="line">        <span class="comment">/* Avoid undefined behavior after multi-core sync-up failed */</span></div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">        {</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = tfm_ns_mailbox_init(&amp;ns_mailbox_queue);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != MAILBOX_SUCCESS)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Non-secure mailbox initialization failed. */</span></div>
<div class="line">        <span class="comment">/* Avoid undefined behavior after NS mailbox initialization failed */</span></div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">        {</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_cy_mqtt_connect_pkcs( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations. */</span></div>
<div class="line">    cy_rslt_t                     TestRes = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a>        connect_info;</div>
<div class="line">    <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a>         broker_info;</div>
<div class="line">    cy_awsport_ssl_credentials_t  credentials;</div>
<div class="line">    cy_awsport_ssl_credentials_t  *security = NULL;</div>
<div class="line">    uint8_t                       *buffer = NULL;</div>
<div class="line">    (void)TestRes;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef CY_TFM_PSA_SUPPORTED</span></div>
<div class="line">    tfm_ns_multi_core_boot();</div>
<div class="line">    <span class="comment">/* Initialize TFM interface */</span></div>
<div class="line">    tfm_ns_interface_init();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the MQTT network socket. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga5386e4d0061fd77c3f68ba29553b3414">cy_mqtt_init</a>();</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Allocate the network buffer. */</span></div>
<div class="line">    buffer = (uint8_t *) malloc( <span class="keyword">sizeof</span>(uint8_t) * NETWORK_BUFFER_SIZE );</div>
<div class="line">    <span class="keywordflow">if</span>( buffer == NULL )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset( &amp;broker_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__broker__info__t.html">cy_mqtt_broker_info_t</a> ) );</div>
<div class="line">    memset( &amp;connect_info, 0x00, <span class="keyword">sizeof</span>( <a class="code hl_struct" href="structcy__mqtt__connect__info__t.html">cy_mqtt_connect_info_t</a> ) );</div>
<div class="line">    memset( &amp;credentials, 0x00, <span class="keyword">sizeof</span>( cy_awsport_ssl_credentials_t ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Do not pass any certificate and key from application. */</span></div>
<div class="line">    credentials.client_cert = NULL;</div>
<div class="line">    credentials.client_cert_size = 0;</div>
<div class="line">    credentials.private_key = NULL;</div>
<div class="line">    credentials.private_key_size = 0;</div>
<div class="line">    credentials.root_ca = NULL;</div>
<div class="line">    credentials.root_ca_size = 0;</div>
<div class="line"> </div>
<div class="line">    security = &amp;credentials;</div>
<div class="line"> </div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a3df6c6eb014ef6e7566616ece9fa5b1b">client_id</a> = MQTT_CLIENT_IDENTIFIER;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#ad6ff55a3dfeb52324950c2447d9c8c4e">client_id_len</a> = MQTT_CLIENT_IDENTIFIER_LENGTH;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a40ded02bb2c432ed7080c1589ebef8e5">keep_alive_sec</a> = MQTT_KEEP_ALIVE_INTERVAL_SECONDS;</div>
<div class="line">    connect_info.<a class="code hl_variable" href="structcy__mqtt__connect__info__t.html#a0238ef1799952c8eeaf4c61c9187c3a6">will_info</a> = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* MQTT broker information. */</span></div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a1573327c42b9dd49610c55aa303e7fea">hostname</a> = MQTT_BROKER;</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#a38a8850406cc4f8e267e67837a23cd41">hostname_len</a> = strlen(MQTT_BROKER);</div>
<div class="line">    broker_info.<a class="code hl_variable" href="structcy__mqtt__broker__info__t.html#ad90a2e276913e9598673e31d55ce808e">port</a> = MQTT_PORT_SECURED;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create MQTT Handle. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga6637e2df9ebc12dfb98841fc38c88ce9">cy_mqtt_create</a>( buffer, NETWORK_BUFFER_SIZE,</div>
<div class="line">                              security, &amp;broker_info,</div>
<div class="line">                              (<a class="code hl_typedef" href="group__mqtt__api__functions.html#ga127e0c74fd6f6025f4866d581256df96">cy_mqtt_callback_t</a>)mqtt_event_cb_pkcs, NULL,</div>
<div class="line">                              &amp;mqtthandle_pkcs );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* During connect, certificates and keys stored in secured memory of &#39;CY8CKIT-064S0S2-4343W&#39; will be used. */</span></div>
<div class="line">    TestRes = <a class="code hl_function" href="group__mqtt__api__functions.html#ga2ffecf6ed7940d97c2c6fbc83783417b">cy_mqtt_connect</a>( mqtthandle_pkcs, &amp;connect_info );</div>
<div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>MQTT client library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
</body>
</html>
